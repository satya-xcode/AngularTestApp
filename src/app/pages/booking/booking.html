<div class="container mt-4">
    <div class="col-12">
        <h3 class="mb-3">Vehicle Bookings</h3>

        @if (loading() && bookings().length === 0) {
        <div class="text-center p-3">
            <div class="spinner-border text-primary" role="status"></div>
            <p>Loading bookings...</p>
        </div>
        }

        @if (error()) {
        <div class="alert alert-danger">{{ error() }}</div>
        }

        @if (message()) {
        <div class="alert alert-success">{{ message() }}</div>
        }

        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>Booking ID</th>
                    <th>Customer</th>
                    <th>Date</th>
                    <th>Mobile</th>
                    <th>Brand</th>
                    <th>Model</th>
                    <th>Discount</th>
                    <th>Total Bill</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @for (booking of bookings(); track booking.BookingId) {
                <tr>
                    <td>{{ booking.BookingId }}</td>
                    <td>{{ booking.CustomerName }}</td>
                    <td>{{ booking.BookingDate }}</td>
                    <td>{{ booking.MobileNo }}</td>
                    <td>{{ booking.Brand }}</td>
                    <td>{{ booking.Model }}</td>
                    <td>{{ booking.Discount }}</td>
                    <td>{{ booking.TotalBillAmount }}</td>
                    <td>
                        <button (click)="editBooking(booking)" class="btn btn-sm btn-warning me-1">
                            <i class="fa fa-pencil"></i>
                        </button>
                        <button (click)="deleteBooking(booking.BookingId)" class="btn btn-sm btn-danger"
                            [disabled]="loading()">
                            <i class="fa fa-trash"></i>
                        </button>
                    </td>
                </tr>
                } @empty {
                <tr>
                    <td colspan="9" class="text-center">No bookings found.</td>
                </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="card p-3 mt-4">
        <h5 class="card-title">{{ bookingForm.get('bookingId')?.value ? 'Edit' : 'Add' }} Booking</h5>
        <form [formGroup]="bookingForm" (ngSubmit)="saveBooking()">
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="customerName" class="form-label">Customer Name</label>
                    <input id="customerName" formControlName="customerName" placeholder="Customer Name"
                        class="form-control">
                </div>
                <div class="col-md-6">
                    <label for="mobileNo" class="form-label">Mobile No</label>
                    <input id="mobileNo" formControlName="mobileNo" placeholder="Mobile No" class="form-control">
                </div>

                <div class="col-md-12">
                    <label for="carId" class="form-label">Car</label>
                    <select id="carId" formControlName="carId" class="form-select">
                        <option value="" disabled>Select a Car</option>
                        @for (car of cars(); track car.CarId) {
                        <option [value]="car.CarId">{{car.Brand}} {{car.Model}} ({{car.RegNo}})</option>
                        }
                    </select>
                </div>

                <div class="col-md-4">
                    <label for="discount" class="form-label">Discount</label>
                    <input id="discount" type="number" formControlName="discount" placeholder="Discount"
                        class="form-control">
                </div>

                <div class="col-md-4">
                    <label for="totalBillAmount" class="form-label">Total Bill</label>
                    <input id="totalBillAmount" type="number" formControlName="totalBillAmount"
                        placeholder="Total Bill Amount" class="form-control">
                </div>
                <div class="col-md-4">
                    <label for="bookingDate" class="form-label">Booking Date</label>
                    <input id="bookingDate" type="date" formControlName="bookingDate" placeholder="Date"
                        class="form-control">
                </div>

            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-primary me-2" [disabled]="bookingForm.invalid || loading()">
                    @if (loading()) {
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    <span class="visually-hidden">Loading...</span>
                    } @else {
                    <span>{{ bookingForm.get('bookingId')?.value ? 'Update' : 'Save' }}</span>
                    }
                </button>
                <button type="button" class="btn btn-secondary" (click)="bookingForm.reset()">Cancel</button>
            </div>
        </form>
    </div>
</div>